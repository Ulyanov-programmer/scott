import{elementIsExistWithLog as r,sleep as l}from"../general.js";export class Ajar{constructor(t){this.deleteButtonAfterOpening=!1;this.defaultHeight=t.defaultHeight,this.deleteButtonAfterOpening=t.deleteButtonAfterOpening}}export default class a{constructor(t){this.maxWorkWidth=99999999;this.spoilerClass="spoiler";this.buttonClass=`${this.spoilerClass}-button`;this.contentClass=`${this.spoilerClass}-content`;this.contentWrapperClass=`${this.contentClass}-wrapper`;this.animationTogglingClass="_slide_";this.buttonActiveClass="active";this.contentActiveClass="active";this.toggleSpoilerStateHandler=function(t){this.toggleSpoilerState(t)}.bind(this);this.enableAjarSpoilerStateHandler=function(t){this.toggleAjarSpoiler(t,this.ajar,this.getActiveSpoilerWrapper(t))}.bind(this);var i,e,n;if(r("Spoiler",t.wrappersSelector))(t.maxWorkWidth<0||t.animationDuration<0)&&console.log("[Spoiler] maxWorkWidth < 0 or animationDuration < 0!");else return;this.buttons=document.querySelectorAll(`${t.wrappersSelector} .${this.buttonClass}`),this.contentElements=document.querySelectorAll(`${t.wrappersSelector} .${this.contentClass}`),this.contentWrapperElements=document.querySelectorAll(`${t.wrappersSelector} .${this.contentClass} .${this.contentWrapperClass}`),this.buttonActiveClass=(i=t.buttonActiveClass)!=null?i:this.buttonActiveClass,this.contentActiveClass=(e=t.contentActiveClass)!=null?e:this.contentActiveClass,this.maxWorkWidth=(n=t.maxWorkWidth)!=null?n:this.maxWorkWidth,this.animationDuration=t.animationDuration,t.ajar?(this.ajar=t.ajar,this.setAjarSpoilers(),window.addEventListener("resize",this.setAjarSpoilers.bind(this))):(this.setSpoilers(),window.addEventListener("resize",this.setSpoilers.bind(this)))}setSpoilers(){for(let t=0;t<this.contentElements.length;t++)window.innerWidth<=this.maxWorkWidth?(this.contentElements[t].style.display="grid",this.contentElements[t].style.transitionProperty="grid-template-rows",this.contentElements[t].style.transitionDuration=`${this.animationDuration}ms`,this.contentElements[t].style.transitionTimingFunction="ease",this.contentWrapperElements[t].style.overflow="hidden",this.buttons[t].style.cursor="",this.buttons[t].addEventListener("click",this.toggleSpoilerStateHandler),this.isSpoilerContentActive(this.contentElements[t])?this.spoilerDown(this.contentElements[t],this.animationDuration):(this.spoilerUp(this.contentElements[t],this.animationDuration),this.toggleSpoilerContentNodesVisibility(!1,this.contentWrapperElements[t]))):(this.contentElements[t].style.display="",this.contentElements[t].style.gridTemplateRows="",this.contentElements[t].style.transitionProperty="",this.contentElements[t].style.transitionDuration="",this.contentElements[t].style.transitionTimingFunction="",this.contentElements[t].style.pointerEvents="",this.contentWrapperElements[t].style.overflow="",this.buttons[t].style.cursor="default",this.buttons[t].removeEventListener("click",this.toggleSpoilerStateHandler),this.toggleSpoilerContentNodesVisibility(!0,this.contentWrapperElements[t]))}toggleSpoilerState(t){let i=this.getActiveSpoilerWrapper(t),e=t.currentTarget,n=i.querySelector(`.${this.contentClass}`);this.canToggleSpoiler(n)!=!1&&(this.toggleSpoiler(n,this.animationDuration),e.classList.toggle(this.contentActiveClass),n.classList.toggle(this.contentActiveClass))}toggleSpoiler(t,i){t.style.gridTemplateRows=="0fr"?this.spoilerDown(t,i):this.spoilerUp(t,i)}canToggleSpoiler(t){return t.classList.contains(this.animationTogglingClass)?!1:(t.classList.add(this.animationTogglingClass),!0)}spoilerUp(t,i){t.style.gridTemplateRows="0fr",t.style.pointerEvents="none",window.setTimeout(()=>{t.classList.remove(this.animationTogglingClass),this.toggleSpoilerContentNodesVisibility(!1,t.querySelector(`.${this.contentWrapperClass}`))},i)}spoilerDown(t,i){t.style.gridTemplateRows="1fr",t.style.pointerEvents="all",this.toggleSpoilerContentNodesVisibility(!0,t.querySelector(`.${this.contentWrapperClass}`)),window.setTimeout(()=>{t.classList.remove(this.animationTogglingClass)},i)}toggleSpoilerContentNodesVisibility(t,i){let e=i.children;if(t)for(let n of e)n.style.visibility="";else for(let n of e)n.style.visibility="hidden"}setAjarSpoilers(){for(let t=0;t<this.contentElements.length;t++)window.innerWidth<=this.maxWorkWidth?this.toggleAjarFunctionality(!0,this.ajar):this.toggleAjarFunctionality(!1,this.ajar)}async toggleAjarSpoiler(t,i,e){let n=e.querySelector(`.${this.buttonClass}`),s=e.querySelector(`.${this.contentClass}`);s.style.transitionProperty="height",s.style.transitionDuration=`${this.animationDuration}ms`,this.isSpoilerContentActive(s)==!1?(s.style.height=`${s.scrollHeight-1}px`,await l(this.animationDuration),s.style.height="",s.classList.add(this.contentActiveClass),i.deleteButtonAfterOpening&&n&&n.remove()):(s.style.overflow="hidden",s.style.height=`${s.clientHeight}px`,await l(10),s.style.height=i.defaultHeight,await l(this.animationDuration),s.classList.remove(this.contentActiveClass))}toggleAjarFunctionality(t,i){if(t)for(let e=0;e<this.contentElements.length;e++)this.isSpoilerContentActive(this.contentElements[e])==!1&&(this.contentElements[e].style.overflow="hidden",this.contentElements[e].style.height=i.defaultHeight,this.buttons[e].addEventListener("click",this.enableAjarSpoilerStateHandler,!1));else for(let e=0;e<this.contentElements.length;e++)this.contentElements[e].style.overflow="",this.contentElements[e].style.height="",this.buttons[e].removeEventListener("click",this.enableAjarSpoilerStateHandler,!1)}getActiveSpoilerWrapper(t){return t.currentTarget.parentElement}isSpoilerContentActive(t){return!!t.classList.contains(this.contentActiveClass)}}
